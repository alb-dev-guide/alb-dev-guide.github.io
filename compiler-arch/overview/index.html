<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://alb-dev-guide.github.io/compiler-arch/overview/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Overview of the Compiler - Guide to Alb Development</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Overview of the Compiler";
    var mkdocs_page_input_path = "compiler-arch/overview.md";
    var mkdocs_page_url = "/compiler-arch/overview/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Guide to Alb Development</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">About this Guide</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Compiler Architecture</span></p>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Overview of the Compiler</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#a-brief-tour-of-how-alb-compiles-programs">A brief tour of how alb compiles programs:</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#desugaring">Desugaring:</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#kind-inference-and-type-inference">Kind Inference and Type Inference:</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Source Code Representation</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../todo/">IMPEG</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../todo/">XMPEG</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">LC Generation and mil-tools Backend</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../todo/">Todo</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Guide to Alb Development</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Compiler Architecture &raquo;</li>
        
      
    
    <li>Overview of the Compiler</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="compiler-overview">Compiler overview</h1>
<h2 id="a-brief-tour-of-how-alb-compiles-programs">A brief tour of how alb compiles programs:</h2>
<p>Compilation process begins in <a href="https://github.com/habit-lang/alb/blob/master/src/Driver.hs">Driver.hs</a>, the entrypoint
of alb. When alb is invoked, it will:</p>
<ul>
<li>Build options from passed in command line arguments and/or .alb dotfile.</li>
<li>Build a list of filepaths with <code>findFiles</code> from each path passed in, searching for valid .hb/.lhb files if path to
directories were given.</li>
<li>After a list of filepaths have been constructed, load the files and attempt to lex and parse them by invoking
<code>readProgram</code> (TODO: break down and explain steps of lexing/parsing), and perform "Import Chasing";
For each file, it will check the list of "requires" and building a list of dependencies to other files. </li>
<li>Then after parsing is done and no errors are encountered, build the compiler pipeline and execute it.
This is where the magic happens.</li>
</ul>
<p>alb's compiler pipeline is defined in the
<a href="https://github.com/habit-lang/alb/blob/master/src/Driver.hs#L293"><code>buildPipeline</code> function</a>,
which consists of the following "phases" (which themselves are made up of smaller "passes"):</p>
<ul>
<li><a href="#desugaring">Desugaring</a></li>
<li><a href="#kind-inference-and-type-inference">Kind Inference</a></li>
<li><a href="#kind-inference-and-type-inference">Type Inference</a></li>
<li><a href="">Specialization</a></li>
<li><a href="">Normalization</a></li>
<li><a href="">LC Generation</a></li>
</ul>
<p>Keen readers will also notice two additional stages in <code>buildPipeline</code>, LLVMed and Compiled. At the end of the frontend 
phases which ends with LC Generation, alb's job is done. The generated LC code is merely passed on to
<a href="https://github.com/habit-lang/mil-tools/">milc</a> to do the hard work of emitting LLVM IR and machine code.</p>
<p>In this chapter we will look into how each of these frontend phases transform the code from a bird's eye view,
and in more detail in later chapters.</p>
<h3 id="desugaring">Desugaring:</h3>
<p>First, the compiler will attempt to "desugar" the program; decomposing higher-lever features into core language 
constructs. As they will no longer have to deal with syntactic sugar, this step helps simplify the code for 
subsequent phases (and passes). In alb, we have the following passes:</p>
<ul>
<li><a href="https://github.com/habit-lang/alb/blob/master/src/Analyzer/Fixity.hs">fixityProgram</a>: Resolve infix operators, 
i.e. rewriting 1 + 2 into applicative form (+) 1 2.</li>
<li><a href="https://github.com/habit-lang/alb/blob/master/src/Analyzer/Freshening.hs">freshenProgram</a>: "Freshen" by assigning
unique name to each variable bindings, i.e. when there are variables that shadows another, give it a new unique name
so as it does not conflict.</li>
<li><a href="">eliminateTuplesProgram</a>: TODO</li>
<li><a href="">patternTuplesProgram</a>: TODO </li>
<li><a href="">generateTuples</a>: TODO</li>
<li><a href="">desugarProgram</a>: TODO</li>
<li><a href="">rewriteFunctionalNotation</a>: TODO</li>
</ul>
<p>By the end of the desugaring phase, the program will have been translated into a simpler, compiler-friendly subset of Habit, dubbed <code>IMPEG</code>. We use <code>IMPEG</code> to do <a href="#kind-inference-and-type-inference">Kind Inference and Type Inference</a>.</p>
<blockquote>
<p><strong>Intermediate representations</strong></p>
<p>As with most compilers, <code>alb</code> works with several intermediate representation (IR) internally during the compilation
process. Language features that might complicate compilation are stripped away, what's left is a representation
that is less error-prone to work with and easier to apply crucial transformations and optimizations on.</p>
<p>During compilation, a Habit program have gone through transformations into a couple different IRs,
each optimized for different phases: <code>IMPEG</code>, <code>XMPEG</code>, <code>LC</code>, <code>MIL</code> and <code>LLVM IR</code>.
(TODO: why is blockquote styling broken?)</p>
<p>(TODO: why is blockquote styling broken?)</p>
</blockquote>
<h3 id="kind-inference-and-type-inference">Kind Inference and Type Inference:</h3>
<p>TODO</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../todo/" class="btn btn-neutral float-right" title="IMPEG">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../.." class="btn btn-neutral" title="About this Guide"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../.." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../todo/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
